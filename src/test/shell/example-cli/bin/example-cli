#!/usr/bin/env bash
set -euo pipefail

# 解析脚本真实路径（支持 symlink，如 Homebrew 安装）
__resolve_project_root() {
  local src="${BASH_SOURCE[0]}"
  local dir
  while [[ -L "$src" ]]; do
    dir="$(cd -P "$(dirname "$src")" && pwd)"
    src="$(readlink "$src")"
    [[ "$src" != /* ]] && src="$dir/$src"
  done
  local bin_dir
  bin_dir="$(cd -P "$(dirname "$src")" && pwd)"
  dirname "$bin_dir"
}

export RADP_APP_ROOT="$(__resolve_project_root)"

# 加载 radp-bash-framework
if ! command -v radp-bf &>/dev/null; then
  echo "Error: radp-bash-framework not found. Please install it first." >&2
  echo "  See: https://github.com/xooooooooox/radp-bash-framework" >&2
  exit 1
fi

# shellcheck source=/dev/null
source "$RADP_APP_ROOT/src/main/shell/vars/constants.sh"

# 自定义 banner（可选，在 framework 之前定义）
# shellcheck disable=SC2154
radp_app_banner() {
  cat <<'BANNER'
    ____  ___    ____  ____     ________    ____
   / __ \/   |  / __ \/ __ \   / ____/ /   /  _/
  / /_/ / /| | / / / / /_/ /  / /   / /    / /
 / _, _/ ___ |/ /_/ / ____/  / /___/ /____/ /
/_/ |_/_/  |_/_____/_/       \____/_____/___/
BANNER
  printf ' :: example_cli ::                       (%s)\n' "$gr_example_cli_version"
  printf ' :: radp-bash-framework ::               (%s)\n' "$gr_fw_version"
}

# 应用声明式配置
export RADP_APP_NAME="example_cli"
export RADP_APP_GLOBAL_OPTIONS="-v --verbose --debug"

# 启动：框架负责全部初始化和 dispatch
# shellcheck source=/dev/null
source "$(radp-bf path launcher)" "$@"
